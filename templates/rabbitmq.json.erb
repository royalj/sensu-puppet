{
  "rabbitmq":[ 
<% @rabbitmq_config.each do |x| -%>
    {
      "host": "<%= x['rabbitmq_host'] %>",
      "password": "<%= x['rabbitmq_password'] %>",
      "vhost": "<%= x['rabbitmq_vhost'] %>",
      "port": "<%= x['rabbitmq_port'] %>",
      "user": "<%= x['rabbitmq_user'] %>",
<% unless x['rabbitmq_ssl_cert_chain'].nil? && x['rabbitmq_ssl_private_key'].nil? -%>
    "ssl": {
      "cert_chain_file": "<%= @rabbitmq_config[count]['rabbitmq_ssl_cert_chain'] %>",
      "private_key_file": "<%= @rabbitmq_config[count]['rabbitmq_ssl_private_key'] %>"
    } 
<% end -%>
}
<% unless x == @rabbitmq_config.last -%>,<% end -%>
<% end -%>
  ]
}
